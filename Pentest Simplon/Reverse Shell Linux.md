

**Pr√©requis :**  
* Une VM Kali  
* Une VM Debian 12 ou 13  
* Sur le m√™me r√©seau bien s√ªr.  

### C√¥t√© cible : Installer et param√©trer Samba sur la cible  
En effet, on profitera du paratge SMB actif pour uploader le payload sur la machine cible.  

* Installation de Samba (SMB Linux)  
`sudo apt install samba`  
`sudo smbd --version permet de voir la version et donc qu'il est bien install√©`  

D√©marrage au lancement de l'OS, puis d√©marrage, puis v√©rif du status :
`systemctl enable smbd`  
`systemctl start smbd`  
`systemctl status smbd` : ‚úÖ Si "Active" on passe √† la suite  
 

#### Param√®trage du fichier de configuraton de samba
Il se trouve √† : `/etc/samba/smb.conf`  
A √©diter en root, ajouter la config du nouveu partage :  

```ini
[partage]
comment = Partage de donn√©es
path = /srv/partage
guest ok = no
read only = no
browsable = yes
```
On y retrouve :  
* le nom du [partage].  
* le chemin physique sur le serveur.  
* les users non authentif√©s ne pourront pas se connecter.  
* Pas de lecture seule.  
* Serveur visible lorsque l'on liste les partages.  

#### Ajouter utilisateur dans smb
Il faut ajouter un compte sp√©cifique sur smb user/password (car il peut √™tre diff√©rent d'une session syst√®me linux)  
`sudo smbpasswd -a smbuser`  
`sudo smbpasswd -e smbuser` : Activation du user sur smb.  



`sudo mkdir /srv/partage` : Cr√©ation du dossier partag√©.    
`sudo chown smbuser:smbuser /srv/partage` : Attribution des droits uniquement √† un user sp√©cifique.  
`sudo chmod 700 /srv/partage` : droits uniquement pour le user propri√©taire, les autres ne peuvent rien faire (enfin pour l'instant^^)  

Le serveur est pr√™t √† se faire Pwn !  

---

### C√¥t√© attaquant  

#### Phase de reconnaissance :  
![alt text](<../Images/Capture d'√©cran 2026-02-13 193130.png>)  
>:bulb: On identifie bien le serveur SMB actif !  

---

#### Enum√©ration des partages :  
![alt text](<../Images/Capture d'√©cran 2026-02-13 194625.png>)  
>:bulb: Nous avons r√©cup√©r√© depuis notre attaquant le nom du dossier en partage.  

Lorsque l'on tente une connexion sans mot de passe, on est refus√©.  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 195340.png>)
On va devoir craquer les credentials.  

---

#### Exploitation avec Brute Force des credentials  

D√©marrage de Metasploit :  
J'ai choisi de le faire avec Metasploit ici.  
`service postgresql start && msfconsole`  

![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 200119.png>)

 module `auxiliary/scanner/smb/smblogin` permet de tester des connexions avec des passwords et usernames.  

J'ai cr√©√© 2 wordlistes :  
* 1 pour les utilisateurs  
* 1 pour les mots de passes  
On rentre les param√®tres et on lance le brute force.  


**üü© User : smbuser**  
**üü© Password : smbpwnd**  

Connection avec nos informations (partage/user/password) :  

![alt text](<../Images/Capture d'√©cran 2026-02-13 201212.png>)  

On est dans le partage de la cible ! On ouvre le flag.  

#### G√©n√©ration du payload  

![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 200408.png>)  

#### Upload du payload renomm√© en JO_2026.bin sur le SMB de la cible  
JO_2026.bin car notre cible aime les JO ^^.  
![alt text](<../Images/Capture d'√©cran 2026-02-13 212010.png>)  


#### Lancement d'un port en √©coute sur la machine attaquante 
On param√®tre notre machine, notre port d'√©coute et plus qu'√† attendre.  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 212522.png>)

#### Ex√©cution du payload par la cible.  
La cible ex√©cute le binaire :  
![alt text](<../Images/Capture d'√©cran 2026-02-13 212434.png>)

#### G√©n√©ration du meterpreter
Au m√™me moment nous obtenons le meterpreter sur notre machine en √©coute sur le port 4444 c√¥t√© attaquant.  
![alt text](<../Images/Capture d'√©cran 2026-02-13 212541.png>)  

---

#### Post Exploitation... 
On v√©rifie la machine et le user :  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 213649.png>)  

On v√©rife ses droits :  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-13 214522.png>)  
Il est dans le groupe des sudo.  

R√©cup√©ration des hashes de mots de passes.  
![alt text](<../Images/Capture d'√©cran 2026-02-13 215155.png>)   
 
Recherche d'une connection persistante...  
>:bulb: A la phase de reconnaissance, nous avions vu que le port 22 √©tait actif.  
>Le user smbuser fait partie du groupe "sudo"...  √ßa sent bon, enfin √ßa d√©pend pour qui !

Rappel du port 22 ouvert :  
![alt text](<../Images/Capture d'√©cran 2026-02-13 193130.png>)  

On se connecte avec notre compte craqu√© :  
![alt text](<../Images/Capture d'√©cran 2026-02-14 120555.png>)  
On est connect√© avec des droits √©lev√©s.  

On peut se cr√©er un compte et l'ajouter au group des "sudo"  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 120912.png>)  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 121914.png>)  


On va se connecter avec notre nouveau compte memebre de sudo, et on se se connecte en "root"  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 124419.png>)  

Changement du mot de passe "Root", alos qu'on ne le connaissait pas avant.
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 122131.png>)  
L√†, on est pas mal ! On a full control.  

Pour se mettre encore mieux on va modifier le fichier config de SSH pour se logger en "root" directement avec notre propre cl√© SSH, sans mot de passe.  
![alt text](<../Images/Capture d'√©cran 2026-02-14 122950.png>)  
On red√©marre le service.  

On g√©n√®re une paire de cl√©s priv√©e/publique sur l'attaquant.  
![alt text](<../Images/Capture d'√©cran 2026-02-14 123525.png>)  

On envoie la cl√© publique sur le compte "root" de la cible. Le mot de passe sera demand√© pour la derni√®re fois.  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 123626.png>)  

On peut se connecter sur la cible en Root, sans mot de passe.  
![alt text](<../Images/Capture d'√©cran 2026-02-14 124844.png>)


Si on pousse le contr√¥le au max et on supprime des comptes...  
![alt text](<../Images/Capture d‚Äô√©cran 2026-02-14 125043.png>)  

Nous avons un acc√®s persistant sur la cible en "Root", en ayant chang√© son mot de passe alors qu'on ne le connaissait pas, cr√©√© des comptes, modifi√© des droits, supprim√© des comptes, conserv√© un acc√®s facile et "s√©curis√©" en SSH avec les cl√©s etc...  Tout cel√† √† cause d'un mot de passe faible et des droits √©lev√©s sur un compte d'un serveur SMB... 

