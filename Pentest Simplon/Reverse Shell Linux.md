

**PrÃ©requis :**  
* Une VM Kali  
* Une VM Debian 12 ou 13  
* Sur le mÃªme rÃ©seau bien sÃ»r.  

### CÃ´tÃ© cible : Installer et paramÃ©trer Samba sur la cible  
En effet, on profitera du paratge SMB actif pour uploader le payload sur la machine cible.  

* Installation de Samba (SMB Linux)  
`sudo apt install samba`  
`sudo smbd --version permet de voir la version et donc qu'il est bien installÃ©`  

DÃ©marrage au lancement de l'OS, puis dÃ©marrage, puis vÃ©rif du status :
`systemctl enable smbd`  
`systemctl start smbd`  
`systemctl status smbd` : âœ… Si "Active" on passe Ã  la suite  
 

#### ParamÃ¨trage du fichier de configuraton de samba
Il se trouve Ã  : `/etc/samba/smb.conf`  
A Ã©diter en root, ajouter la config du nouveu partage :  

```ini
[partage]
comment = Partage de donnÃ©es
path = /srv/partage
guest ok = no
read only = no
browsable = yes
```
On y retrouve :  
* le nom du [partage].  
* le chemin physique sur le serveur.  
* les users non authentifÃ©s ne pourront pas se connecter.  
* Pas de lecture seule.  
* Serveur visible lorsque l'on liste les partages.  

#### Ajouter utilisateur dans smb
Il faut ajouter un compte spÃ©cifique sur smb user/password (car il peut Ãªtre diffÃ©rent d'une session systÃ¨me linux)  
`sudo smbpasswd -a smbuser`  
`sudo smbpasswd -e smbuser` : Activation du user sur smb.  



`sudo mkdir /srv/partage` : CrÃ©ation du dossier partagÃ©.    
`sudo chown smbuser:smbuser /srv/partage` : Attribution des droits uniquement Ã  un user spÃ©cifique.  
`sudo chmod 700 /srv/partage` : droits uniquement pour le user propriÃ©taire, les autres ne peuvent rien faire (enfin pour l'instant^^)  

Le serveur est prÃªt Ã  se faire Pwn !  

---

### CÃ´tÃ© attaquant  

#### Phase de reconnaissance :  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 193130.png>)  
>:bulb: On identifie bien le serveur SMB actif !  

---

#### EnumÃ©ration des partages :  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 194625.png>)  
>:bulb: Nous avons rÃ©cupÃ©rÃ© depuis notre attaquant le nom du dossier en partage.  


#### EnumÃ©ration des Users :  

Avec la commandes `enum4linux 192.168.20.190`, on trouve 2 users.  
> :bulb: enum4linux enumÃ¨re les partages aussi  
>
![alt text](<../Images/Capture d'Ã©cran 2026-02-14 144530.png>)  


Lorsque l'on tente une connexion sans mot de passe, on est refusÃ©.  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 195340.png>)  
On va devoir craquer les credentials.  

---

#### Exploitation avec Brute Force des credentials  

DÃ©marrage de Metasploit :  
J'ai choisi de le faire avec Metasploit ici.  
`service postgresql start && msfconsole`  

![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 200119.png>)

 module `auxiliary/scanner/smb/smblogin` permet de tester des connexions avec des passwords et usernames.  

J'ai crÃ©Ã© 2 wordlistes :  
* 1 pour les 2 utilisateurs trouvÃ©s  
* 1 pour les mots de passes  
On rentre les paramÃ¨tres et on lance le brute force.  


**ğŸŸ© User : smbuser**  
**ğŸŸ© Password : smbpwnd**  

Connection avec nos informations (partage/user/password) :  

![alt text](<../Images/Capture d'Ã©cran 2026-02-13 201212.png>)  

On est dans le partage de la cible ! On ouvre le flag.  

#### GÃ©nÃ©ration du payload  

![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 200408.png>)  

#### Upload du payload renommÃ© en JO_2026.bin sur le SMB de la cible  
JO_2026.bin car notre cible aime les JO ^^.  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 212010.png>)  


#### Lancement d'un port en Ã©coute sur la machine attaquante 
On paramÃ¨tre notre machine, notre port d'Ã©coute et plus qu'Ã  attendre.  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 212522.png>)

#### ExÃ©cution du payload par la cible.  
La cible exÃ©cute le binaire :  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 212434.png>)

#### GÃ©nÃ©ration du meterpreter
Au mÃªme moment nous obtenons le meterpreter sur notre machine en Ã©coute sur le port 4444 cÃ´tÃ© attaquant.  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 212541.png>)  

---

#### Post Exploitation...  

On vÃ©rifie la machine et le user :  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 213649.png>)  

On vÃ©rife ses droits :  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-13 214522.png>)  
**:warning: Il est dans le groupe des sudo !:warning:**  

RÃ©cupÃ©ration des hashes de mots de passes au cas oÃ¹.  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 215155.png>)   
 
Recherche d'une connection persistante...  
>:bulb: A la phase de reconnaissance, nous avions vu que le port 22 Ã©tait actif.  
>Le user smbuser fait partie du groupe "sudo"...  Ã§a sent bon, enfin Ã§a dÃ©pend pour qui !  
>Rappel du port 22 ouvert :  
![alt text](<../Images/Capture d'Ã©cran 2026-02-13 193130.png>)  

On se connecte avec notre compte craquÃ© :  
![alt text](<../Images/Capture d'Ã©cran 2026-02-14 120555.png>)  
**âœ… On est connectÃ© avec des droits Ã©levÃ©s. âœ…**  

On peut se crÃ©er un compte et l'ajouter au group des "sudo"  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 120912.png>)  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 121914.png>)  


On va se connecter avec notre nouveau compte membre de sudo, et on se se connecte en "root"  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 124419.png>)  

**â˜ ï¸ Changement du mot de passe "Root", alos qu'on ne le connaissait pas avant.â˜ ï¸**  

![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 122131.png>)  

**ğŸ´â€â˜ ï¸ LÃ , on est pas mal ! On a full control.ğŸ´â€â˜ ï¸**  
**:exclamation: La cible n'a plus accÃ¨s Ã  "Root".**  

Pour se mettre encore mieux on va modifier le fichier config de SSH pour se logger en "root" directement avec notre propre clÃ© SSH, sans mot de passe.  
![alt text](<../Images/Capture d'Ã©cran 2026-02-14 122950.png>)  
On redÃ©marre le service.  

* On gÃ©nÃ¨re une paire de clÃ©s privÃ©e/publique sur l'attaquant.  
![alt text](<../Images/Capture d'Ã©cran 2026-02-14 123525.png>)  

* On envoie la clÃ© publique sur le compte "root" de la cible. Le mot de passe sera demandÃ© pour la derniÃ¨re fois.  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 123626.png>)  

* â˜ºï¸ On peut se connecter sur la cible en Root, sans mot de passe. â˜ºï¸   
![alt text](<../Images/Capture d'Ã©cran 2026-02-14 124844.png>)  


 >* ğŸ’€ Si on pousse le contrÃ´le au max et on supprime des comptes...ğŸ’€  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 125043.png>)  

---

#### ğŸ’€ Dernier fl@g ! ğŸ’€  
![alt text](<../Images/Capture dâ€™Ã©cran 2026-02-14 145503.png>)  


```bash
echo : "Next_Step_On_Hack_Remi"
```




> âœ… **Nous avons un accÃ¨s persistant sur la cible en "Root", en ayant changÃ© son mot de passe alors qu'on ne le connaissait pas.**
> âœ… **Nous avons scannÃ©, enumÃ©rÃ©, exÃ©cutÃ© un payload sur un service avec un compte Ã  privilÃ¨ge peu sÃ©curisÃ©, obtenu un meterpreter, puis on a pu se logger en SSH sur ce mÃªme compte, ce qui a permit de crÃ©er des comptes, modifier des droits, supprimer des comptes, conserver un accÃ¨s facile et "sÃ©curisÃ©" en SSH avec les clÃ©s, etc...**  
> âœ… **On a fini par Ãªtre le seul Ã  avoir accÃ¨s au serveur.**  

> âœ… **Cela a Ã©tÃ© possible grÃ¢ce ( ou Ã  cause ) d'un mot de passe faible et des droits Ã©levÃ©s sur un compte utilisÃ© sur plusieurs services...**  

### ğŸ±â˜ ï¸ğŸ±  


